description: |
  Save or Load LocalStack state

parameters:
  name:
    description: 'Name of the artifact'
    type: string
    default: 'ls-state'
  action:
    description: 'Action to perform (save or load)'
    type: string
    default: 'save'

steps:
  - when:
      condition:
        equal: [ <<parameters.action>>, load ]
      steps:
        - persist_to_workspace:
            root: .
            paths:
              - <<parameters.name>>.zip
  - run:
      command: |
        if [ "$ACTION" = "save" ]; then
          echo "Saving State $NAME"
          localstack state export ${NAME}.zip
        elif [ "$ACTION" = "load" ]; then
          echo "Loading State $NAME"
          localstack state import ${NAME}.zip
        else
          echo "Invalid action: $ACTION"
          exit 1
        fi
  - when:
      condition:
        equal: [ <<parameters.action>>, save ]
    steps:
      - store_artifacts:
          path: <<parameters.name>>.zip