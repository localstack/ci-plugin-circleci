description: |
  Install and start LocalStack in a background Docker container.

  Use this command to install and start LocalStack in a background Docker container.
  To retrieve the logs from this container, you can use the following command in any subsequent build command:
  ```
  docker logs -f localstack_main
  ```

parameters:
  image-tag:
    type: string
    default: latest
    description: Tag of the localstack/localstack Docker image to use
  install-awslocal:
    type: boolean
    default: true
    description: Whether to install the `awslocal` command line interface into the build environment (requires python3 and pip3)

steps:
  - run:
      name: Install LocalStack
      command: |
        docker pull localstack/localstack:<<parameters.image-tag>> &
        test "<<parameters.install-awslocal>>" != "true" || pip3 install -q localstack awscli-local[ver1]
  - run:
      name: Start LocalStack container
      command: |
        DOCKER_FLAGS='-d' IMAGE_NAME=localstack/localstack:<<parameters.image-tag>> localstack start
